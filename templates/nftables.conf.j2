#!/usr/sbin/nft -f

#
# Do not edit! 
#   Managed by Ansible...
#

flush ruleset

table ip nat {
  chain input {
    type filter hook input priority 0; policy drop;
    iif lo accept;
    iif != {{EXT_NIC}} accept
    ct state established,related accept;
    ct state invalid drop;

    # Commentout to block ping
    icmp type echo-request limit rate 4/second accept;
    icmp type echo-request drop;

{% for port in EXT_TCP %}
    tcp dport { {{port}} } accept;
{% endfor %}
  }

  chain prerouting {
    type nat hook prerouting priority 0; policy accept;
  }
  chain postrouting {
    type nat hook postrouting priority 100; policy accept;
    oif {{EXT_NIC}} masquerade
  }
}
